<html>
    <head>
            <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
            <script src="./tilebase.js"></script>

            <!-- <script type="text/javascript" src="./main.js"></script> -->

            <script>
                
                
                // var                 

                var url = 'ws://'+window.location.host+'/?token=JWT 123';
                tilebaseConv = new Tilebase(  url           
                    , function(data, notification) {
                        //$('#conversations').append(`<div>${data.last_message_text}</div>`);
                        $('#conversations').append(`<div id="c-${data._id}">${data.last_message_text} ${notification.event}</div>`);
                    }
                    , function(object, notification) {
                        //$('#'+data._id).html(`<div>${data.text}  </div>`);
                        $('#c-'+data._id).html(`<div id="c-${data._id}">${data.last_message_text}  ${notification.event}</div>`);

                    }
                    );
                    tilebaseConv.start('{ "action": "subscribe", "payload": { "topic": "/apps/123/users/sendid/conversations/RFN"}}');


                tilebaseMess = new Tilebase(url
                    , function(data, notification) {
                       // $('#messages').append(`<div>${data.text}</div>`);
                       $('#messages').append(`<div id="m-${data._id}">${data.text} ${notification.event}</div>`);
                    }
                    , function(object, notification) {
                        //$('#'+data._id).html(`<div>${data.text}  </div>`);
                        $('#m-'+data._id).html(`<div id="m-${data._id}">${data.text}  ${notification.event}</div>`);

                    }
                    );
                    tilebaseMess.start('{ "action": "subscribe", "payload": { "topic": "/apps/123/users/sendid/messages/RFN"}}');


		    //tilebase.start('{ "action": "subscribe", "payload": { "topic": "/apps/123/users/sendid/messages/RFN"}}');
		    // tilebase.send('{ "action": "subscribe", "payload": { "topic": "/apps/123/users/sendid/conversations/RFN"}}');

                    //tilebase.start('{ "action": "subscribe", "payload": { "topic": "topic1"}}');

                    // { "action": "publish", "payload": { "topic": "topic1", "message": "hi"}}
                    // tilebase.send('{ "action": "publish", "payload": { "topic": "topic1", "message": "hi"}}');

                  
            </script>
    </head>
    <bdoy>
            <h1>
                    Web Socket Example
                </h1>
                <p>
                    open console to see connection.
                
                </p>
                Conversations
                <div id="conversations"></div>
                Messages
                <div id="messages"></div>
                
    </bdoy>
</html>
