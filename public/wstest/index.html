<html>
    <head>
            <script src="./jquery.min.js"></script>
            <script src="./tilebase.js"></script>

            <script>
                
                
                // var                 

                var url = 'ws://'+window.location.host+'/?token=JWT eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJfaWQiOiI1ZGM2ZWQzZGYzYzI2YjZiZTkzZjI2NTkiLCJlbWFpbCI6ImFuZHJlYS5sZW9AZjIxLml0IiwiZW1haWx2ZXJpZmllZCI6ZmFsc2UsImlhdCI6MTU3MzMyMjg4MSwiYXVkIjoiaHR0cHM6Ly9jaGF0MjEub3JnIiwiaXNzIjoiaHR0cHM6Ly9jaGF0MjEub3JnIiwic3ViIjoidXNlciJ9.Tlq0BFrbM89v6XCkcleigyTYSV30kTRgeKXDlzFA2zM';
                tilebaseConv = new Tilebase(  url           
                    , function(data, notification) {
                        $('#conversations').append(`<div id="c-${data._id}">${data.last_message_text} ${data.timelineOf} ${notification.event.method}</div>`);
                    }
                    , function(data, notification) {
                        $('#c-'+data._id).html(`<div id="c-${data._id}">${data.last_message_text} ${data.timelineOf} ${notification.event.method}</div>`);

                    }
                    );
                    tilebaseConv.start('{ "action": "subscribe", "payload": { "topic": "/apps/app1/users/5dc6ed3df3c26b6be93f2659/conversations"}}');


                tilebaseMess = new Tilebase(url
                    , function(data, notification) {
                       $('#messages').append(`<div id="m-${data._id}">${data.text} ${data.timelineOf} ${notification.event.method}</div>`);
                    }
                    , function(data, notification) {
                        $('#m-'+data._id).html(`<div id="m-${data._id}">${data.text} ${data.timelineOf} ${notification.event.method}</div>`);

                    }
                    );
                    tilebaseMess.start('{ "action": "subscribe", "payload": { "topic": "/apps/app1/users/5dc6ed3df3c26b6be93f2659/messages/recipient_id"}}');


		    //tilebase.start('{ "action": "subscribe", "payload": { "topic": "/apps/123/users/sendid/messages/RFN"}}');
		    // tilebase.send('{ "action": "subscribe", "payload": { "topic": "/apps/123/users/sendid/conversations/RFN"}}');

                    //tilebase.start('{ "action": "subscribe", "payload": { "topic": "topic1"}}');

                    // { "action": "publish", "payload": { "topic": "topic1", "message": "hi"}}
                    // tilebase.send('{ "action": "publish", "payload": { "topic": "topic1", "message": "hi"}}');



                tilebaseRConv = new Tilebase(  url  
                    , function(data, notification) {   
                    $('#rconversations').append(`<div id="cr-${data._id}">${data.last_message_text} ${data.timelineOf} ${notification.event.method}</div>`);
                }
                , function(data, notification) {       
                    $('#cr-'+data._id).html(`<div id="cr-${data._id}">${data.last_message_text} ${data.timelineOf} ${notification.event.method}`);
                });

                tilebaseRConv.start('{ "action": "subscribe", "payload": { "topic": "/apps/app1/users/recipient_id/conversations"}}');    

                tilebaseRMess = new Tilebase(url 
                , function(data, notification) {      
                    $('#rmessages').append(`<div id="mr-${data._id}">${data.text} ${data.timelineOf} ${notification.event.method}</div>`);
                                }     
                , function(data, notification) {     
                    $('#mr-'+data._id).html(`<div id="mr-${data._id}">${data.text} ${data.timelineOf} ${notification.event.method}</div>`);
                    }    
                                                                                                                                                                                                                );                                                                                                                                                                                                                                                                 
                        tilebaseRMess.start('{ "action": "subscribe", "payload": { "topic": "/apps/app1/users/recipient_id/messages/5dc6ed3df3c26b6be93f2659"}}');  












                  
            </script>
    </head>
    <bdoy>
            <h1>
                    Web Socket Example2
                </h1>
                <p>
                    open console to see connection.
                
                </p>
                Conversations
                <div id="conversations"></div>
                Messages
                <div id="messages"></div>
		Other conversations
		 <div id="rconversations"></div> 
                Other Messages  
                <div id="rmessages"></div>   
                
    </bdoy>
</html>
